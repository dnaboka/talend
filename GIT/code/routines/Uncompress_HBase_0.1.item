package routines;

import java.io.IOException;

import org.apache.hadoop.hbase.util.Bytes;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.xerial.snappy.Snappy;

public class Uncompress_HBase {

	private static final Logger LOGGER = LoggerFactory.getLogger(Uncompress_HBase.class);

	/**
	 * This method get uncompressed version of content
	 * @param <ByteBuffer>
	 * 
	 * @param invoice
	 * @return
	 */
	public static String getJsonFromSnappy(byte[] invoice) {
//	public static String getJsonFromSnappy(ByteBuffer invoice) {		
		LOGGER.info("Entering at getJsonFromSnappy : {}",System.currentTimeMillis());
		try {
			return Bytes.toString(Snappy.uncompress(invoice));
//			return Bytes.toString(Snappy.uncompress(invoice.wrap()));
		} catch (IOException e) {
			LOGGER.error("ERROR inside getJsonFromSnappy : {}",System.currentTimeMillis());
			return Bytes.toString(invoice);
		} finally {
			LOGGER.info("Exiting at getJsonFromSnappy : {}",System.currentTimeMillis());
		}
//		return null;
	}

	/**
	 * This method returns rowkey without hash content
	 * 
	 * @param rowKey
	 * @return
	 */
	public static String getRowKeyWithouthash(String rowKey) {
		LOGGER.info("Entering getRowKeyWithouthash at : {}", System.currentTimeMillis());
		String finalkey = null;
		try {
			finalkey = rowKey.substring(rowKey.indexOf("|")+1);
//			System.out.println("Final key "+finalkey);
			LOGGER.debug("Modified key value : {}", finalkey);
			return finalkey;
		} catch (Exception e) {
			LOGGER.error("ERROR inside getRowKeyWithouthash with exception : {}",e);
		} finally {
			LOGGER.info("Exiting getRowKeyWithouthash at : {}", System.currentTimeMillis());
		}
		return finalkey;
	}

}